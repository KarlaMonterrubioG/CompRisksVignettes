<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Karla Monterrubio-Gómez, Nathan Constantine-Cooke, and Catalina Vallejos" />

<meta name="date" content="2023-08-25" />

<title>Comparison of predictions</title>

<script src="Predictions_files/header-attrs-2.24/header-attrs.js"></script>
<script src="Predictions_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Predictions_files/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="Predictions_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Predictions_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Predictions_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="Predictions_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="Predictions_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Predictions_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Predictions_files/navigation-1.1/tabsets.js"></script>
<script src="Predictions_files/navigation-1.1/codefolding.js"></script>
<link href="Predictions_files/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="Predictions_files/highlightjs-9.12.0/highlight.js"></script>
<script src="https://kit.fontawesome.com/1339b11c04.js" crossorigin="anonymous"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id = "nav">
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="DataPreparation.html">Data Preparation</a></li>
    <li><a href="CIF_specification.html">Cumulative Incidence</a></li>
    <li><a href="CS_specification.html">Cause Specific</a></li>
    <li><a href="Discrete_specification.html">Discrete</a></li>
    <li><a href="Others.html">Other</a></li>
    <li><a href="Predictions.html">Predictions</a></li>
    <li style="float:right"><a href="https://github.com/VallejosGroup/CompRisksVignettes"><i style="font-size: 20px; padding-top: 0px; padding-bottom: 0px;" class="fa-brands fa-github"></i></a></li>
  </ul>
</div>

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Comparison of predictions</h1>
<h4 class="author">Karla Monterrubio-Gómez, Nathan Constantine-Cooke,
and Catalina Vallejos</h4>
<h4 class="date">2023-08-25</h4>

</div>


<div id="comparing-predictions-at-t5" class="section level1">
<h1>Comparing predictions at <span
class="math inline">\(t=5\)</span></h1>
<div id="loading-the-predictions" class="section level2">
<h2>Loading the predictions</h2>
<p>Here, we load the predicted probabilities of observing an event of
type 1 by <span class="math inline">\(t=5\)</span> that were obtained by
different methods</p>
<pre class="r"><code>if (file.exists(&quot;/.dockerenv&quot;)){
  pred_CS &lt;- read.csv(&quot;/Outputs/pred_CS.csv&quot;)
  pred_CIF &lt;- read.csv(&quot;/Outputs/pred_CIF.csv&quot;)
  pred_Others &lt;- read.csv(&quot;/Outputs/pred_Others.csv&quot;)
  pred_BART &lt;- read.csv(&quot;/Outputs/pred_BART.csv&quot;)
} else {
  pred_CS &lt;- read.csv(&quot;../Outputs/pred_CS.csv&quot;)
  pred_CIF &lt;- read.csv(&quot;../Outputs/pred_CIF.csv&quot;)
  pred_Others &lt;- read.csv(&quot;../Outputs/pred_Others.csv&quot;)
  pred_BART &lt;- read.csv(&quot;../Outputs/pred_BART.csv&quot;)
}

pred_all &lt;- merge(pred_CS, pred_CIF, by = &quot;testID&quot;)
pred_all &lt;- merge(pred_all, pred_Others, by = &quot;testID&quot;)
pred_all &lt;- merge(pred_all, pred_BART, by = &quot;testID&quot;)

names(pred_all)
#&gt;  [1] &quot;testID&quot;                 &quot;coxph_riskRegression&quot;   &quot;coxphPL_riskRegression&quot;
#&gt;  [4] &quot;FG_riskRegression&quot;      &quot;DirectBinomial&quot;         &quot;DPWeibull&quot;             
#&gt;  [7] &quot;RF_logrankCR&quot;           &quot;RF_logrankCR.av&quot;        &quot;crisk2.bart&quot;           
#&gt; [10] &quot;crisk2.bart_dart&quot;       &quot;crisk.bart&quot;</code></pre>
<p>The data above includes predictions obtained using the following
methods:</p>
<ul>
<li><code>coxph_riskRegression</code>: Cause-specific Cox PH (CS Cox)
model</li>
<li><code>coxphPL_riskRegression</code>: Cause-specific Cox PH (CS Cox)
model using a product limit (PL) approach to calculated predicted
probabilities. The latter ensures that (in the limit) the event-specific
probabilities sum up to 1 across events.</li>
<li><code>FG_riskRegression</code>: Fine &amp; Gray (F&amp;G)
regression<br />
</li>
<li><code>DirectBinomial</code>: Direct binomial<br />
</li>
<li><code>DPWeibull</code>: Dependent Dirichlet Process<br />
</li>
<li><code>RF_logrankCR</code>: Random Forests (RF) using a modified
Gray’s criteria as the splitting rule, focusing on the first event type.
The latter aims to identify covariates that affect the CIF for the first
event type.</li>
<li><code>RF_logrankCR.av</code>: as above, but the splitting rule
considers the average between the first and second event types.</li>
<li><code>crisk2.bart</code>: BART using its first formulation<br />
</li>
<li><code>crisk2.bart_dart</code>: DART - a variation of BART (first
formulation) that enables feature selection</li>
<li><code>crisk.bart</code>: BART using its second formulation</li>
</ul>
</div>
<div id="pairwise-comparison" class="section level2">
<h2>Pairwise comparison</h2>
<p>As shown below, all methods led to correlated predictions. The
greatest similarity was between the classical approaches (CS Cox,
F&amp;G, Direct binomial). BART, under its second formulation, also led
to similar predictions. RF exhibited the greatest discrepancy with
respect to such methods above. Note that for the different BART
approaches and DPWeibull, predicted probabilities may be affected by
lack of convergence of the algorithm.</p>
<pre class="r"><code>library(GGally)
#&gt; Registered S3 method overwritten by &#39;GGally&#39;:
#&gt;   method from   
#&gt;   +.gg   ggplot2
#&gt; 
#&gt; Attaching package: &#39;GGally&#39;
#&gt; The following object is masked from &#39;package:pander&#39;:
#&gt; 
#&gt;     wrap

# Code to control axis limits was adapted from: https://stackoverflow.com/questions/53277656/how-to-define-facet-axis-limits-in-ggpairs-function
scatter_limitRange &lt;- function(data, mapping, ...) { 
  ggplot(data = data, mapping = mapping, ...) + 
    geom_point(..., col = &quot;#1A5276&quot;, alpha = 0.5) + 
    geom_abline(intercept = 0, slope = 1) +
    scale_x_continuous(limits = c(min(pred_all[,-1]), max(pred_all[,-1]))) +
    scale_y_continuous(limits = c(min(pred_all[,-1]), max(pred_all[,-1]))) +
    theme_classic()
}
dens_limitRange &lt;- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping, ...) + 
    geom_density(..., col = &quot;#1A5276&quot;, fill = &quot;#1A5276&quot;) + 
    scale_x_continuous(limits = c(min(pred_all[,-1]), max(pred_all[,-1]))) +
    theme_classic()
}

my.labels &lt;- c(&quot;CS Cox&quot;, &quot;CS Cox (PL)&quot;, &quot;F&amp;G&quot;, &quot;Direct Binomial&quot;, 
               &quot;DPWeibull&quot;, &quot;RF logrankCR (1)&quot;, &quot;RF logrankCR (av)&quot;, 
               &quot;BART (1)&quot;, &quot;DART (1)&quot;, &quot;BART (2)&quot;)

ggpairs(pred_all, columns = 2:11, progress = FALSE,
        lower = list(continuous = scatter_limitRange),
        diag = list(continuous = dens_limitRange),
        columnLabels = my.labels)</code></pre>
<p><img src="Predictions_files/figure-html/unnamed-chunk-1-1.png" width="1152" /></p>
<pre class="r"><code>
if (file.exists(&quot;/.dockerenv&quot;)){ # running in docker
  ggsave(&quot;/Outputs/Comparison_predictions_t5.pdf&quot;, device = &quot;pdf&quot;)
} else {
  ggsave(&quot;../Outputs/Comparison_predictions_t5.pdf&quot;, device = &quot;pdf&quot;)
}
#&gt; Saving 12 x 12 in image</code></pre>
<p>To evaluate the predictive performance for each methods, users can
follow the examples provided by <a
href="https://github.com/survival-lumc/ValidationCompRisks">van Geloven
et al</a>.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<div id="refs">

</div>
</div>
<div id="session-info" class="section level1">
<h1>Session Info</h1>
<pre class="r"><code>sessionInfo()
#&gt; R version 4.3.1 (2023-06-16)
#&gt; Platform: aarch64-unknown-linux-gnu (64-bit)
#&gt; Running under: Ubuntu 22.04.3 LTS
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /usr/lib/aarch64-linux-gnu/openblas-pthread/libblas.so.3 
#&gt; LAPACK: /usr/lib/aarch64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0
#&gt; 
#&gt; locale:
#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
#&gt; 
#&gt; time zone: Etc/UTC
#&gt; tzcode source: system (glibc)
#&gt; 
#&gt; attached base packages:
#&gt; [1] parallel  stats     graphics  grDevices utils     datasets  methods  
#&gt; [8] base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] GGally_2.1.2              randomForestSRC_3.2.2    
#&gt;  [3] BART_2.9.4                nlme_3.1-162             
#&gt;  [5] nnet_7.3-19               pander_0.6.5             
#&gt;  [7] mboost_2.9-7              stabs_0.6-4              
#&gt;  [9] glmnet_4.1-8              Matrix_1.6-1             
#&gt; [11] pec_2023.04.12            rms_6.7-0                
#&gt; [13] Hmisc_5.1-0               patchwork_1.1.3          
#&gt; [15] lubridate_1.9.2.9000      forcats_1.0.0            
#&gt; [17] stringr_1.5.0             dplyr_1.1.2              
#&gt; [19] purrr_1.0.2               tidyr_1.3.0              
#&gt; [21] tibble_3.2.1              ggplot2_3.4.3            
#&gt; [23] tidyverse_2.0.0           coda_0.19-4              
#&gt; [25] DPWeibull_1.8             timereg_2.0.5            
#&gt; [27] pseudo_1.4.3              geepack_1.3.9            
#&gt; [29] KMsurv_0.1-5              riskRegression_2023.03.22
#&gt; [31] prodlim_2023.03.31        cmprsk_2.2-11            
#&gt; [33] survival_3.5-5            splitstackshape_1.4.8    
#&gt; [35] readr_2.1.4              
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;   [1] RColorBrewer_1.1-3  libcoin_1.0-9       rstudioapi_0.15.0  
#&gt;   [4] jsonlite_1.8.7      shape_1.4.6         magrittr_2.0.3     
#&gt;   [7] TH.data_1.1-2       farver_2.1.1        rmarkdown_2.24     
#&gt;  [10] ragg_1.2.5          vctrs_0.6.3         truncdist_1.0-2    
#&gt;  [13] binaryLogic_0.3.9   base64enc_0.1-3     htmltools_0.5.6    
#&gt;  [16] polspline_1.1.23    broom_1.0.5         Formula_1.2-5      
#&gt;  [19] sass_0.4.7          parallelly_1.36.0   bslib_0.5.1        
#&gt;  [22] htmlwidgets_1.6.2   plyr_1.8.8          sandwich_3.0-2     
#&gt;  [25] zoo_1.8-12          cachem_1.0.8        lifecycle_1.0.3    
#&gt;  [28] iterators_1.0.14    pkgconfig_2.0.3     R6_2.5.1           
#&gt;  [31] fastmap_1.1.1       future_1.33.0       digest_0.6.33      
#&gt;  [34] numDeriv_2016.8-1.1 reshape_0.8.9       colorspace_2.1-0   
#&gt;  [37] textshaping_0.3.6   labeling_0.4.2      fansi_1.0.4        
#&gt;  [40] timechange_0.2.0    nnls_1.4            compiler_4.3.1     
#&gt;  [43] bit64_4.0.5         withr_2.5.0         htmlTable_2.4.1    
#&gt;  [46] backports_1.4.1     highr_0.10          MASS_7.3-60        
#&gt;  [49] lava_1.7.2.1        quantreg_5.97       tools_4.3.1        
#&gt;  [52] foreign_0.8-84      future.apply_1.11.0 glue_1.6.2         
#&gt;  [55] quadprog_1.5-8      DiagrammeR_1.0.10   mets_1.3.2         
#&gt;  [58] inum_1.0-5          grid_4.3.1          checkmate_2.2.0    
#&gt;  [61] cluster_2.1.4       generics_0.1.3      gtable_0.3.4       
#&gt;  [64] tzdb_0.4.0          data.table_1.14.8   hms_1.1.3          
#&gt;  [67] utf8_1.2.3          foreach_1.5.2       pillar_1.9.0       
#&gt;  [70] vroom_1.6.3         partykit_1.2-20     splines_4.3.1      
#&gt;  [73] lattice_0.21-8      bit_4.0.5           SparseM_1.81       
#&gt;  [76] tidyselect_1.2.0    knitr_1.43          gridExtra_2.3      
#&gt;  [79] stats4_4.3.1        xfun_0.40           visNetwork_2.1.2   
#&gt;  [82] stringi_1.7.12      yaml_2.3.7          evaluate_0.21      
#&gt;  [85] codetools_0.2-19    data.tree_1.0.0     evd_2.3-6.1        
#&gt;  [88] cli_3.6.1           rpart_4.1.19        systemfonts_1.0.4  
#&gt;  [91] munsell_0.5.0       jquerylib_0.1.4     Rcpp_1.0.11        
#&gt;  [94] globals_0.16.2      ellipsis_0.3.2      MatrixModels_0.5-2 
#&gt;  [97] listenv_0.9.0       mvtnorm_1.2-2       scales_1.2.1       
#&gt; [100] crayon_1.5.2        rlang_1.1.1         multcomp_1.4-25</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
